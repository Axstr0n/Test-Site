<!DOCTYPE html>
<html>
  <head>
    <title>Test Site</title>
    <style>
        body {
          background-color: rgba(74, 150, 171, 0.3);
        }
        h1 {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 36px;
            line-height: 40px;
            text-align: center;
            color: rgb(14, 58, 58);
        }
        table, th, td {
          border: 1px solid black;
          border-collapse: collapse;
        }
        .button {
          font-family: Arial, Helvetica, sans-serif;
          background-color: #217153;
          border: 2px solid #dcf1f1;
          color: white;
          padding: 15px 32px;
          text-align: center;
          text-decoration: none;
          display: inline-block;
          font-size: 16px;
          width: 100%;
          margin-bottom: 5px;
        }
        #myTable {
          font-family: Arial, Helvetica, sans-serif;
          border-collapse: collapse;
          width: 100%;
        }

        #myTable td, #myTable th {
          border: 2px solid #dcf1f1;
          padding: 8px;
        }
        #myTable th {
          padding-top: 12px;
          padding-bottom: 12px;
          text-align: left;
          background-color: #04AA6D;
          color: white;
        }
        #myTable td{
          background-color: #a6ead1;
        }
    </style>
  </head>
  <body>
    
    

    <h1>Test Site</h1>
    <button id="SubmitButton">Click</button>
    <input id="Inputbox" type="text">
    <table style="width:100%" id="myTable">
      <thead>
        <tr>
          <th style="width:30%">Date</th>
          <th style="width:30%">Time</th>
          <th style="width:40%">Message</th>
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>

    <script>
    function updateTable1(){
        const date = new Date();
        const day = numberFormat(date.getDate().toString(),2);
        const month = numberFormat((date.getMonth()+1).toString(),2);
        const year = date.getFullYear();
        const dateString = `${day}.${month}.${year}`;
        var hours = numberFormat(date.getHours().toString(),2);
        var minutes = numberFormat(date.getMinutes().toString(),2);
        var seconds = numberFormat(date.getSeconds().toString(),2);
        var milliseconds = numberFormat(date.getMilliseconds().toString(),3);
        const timeString = `${hours}:${minutes}:${seconds}.${milliseconds}`;
        const messageString = "message";
        
        var table = document.getElementById("myTable");
        var row = table.insertRow(1);
        var dateCell = row.insertCell(0);
        var timeCell = row.insertCell(1);
        var messageCell = row.insertCell(2);
        dateCell.innerHTML = dateString;
        timeCell.innerHTML = timeString;
        messageCell.innerHTML = messageString;

    }
    function updateTable(){
        const date = new Date();
        const day = numberFormat(date.getDate().toString(),2);
        const month = numberFormat((date.getMonth()+1).toString(),2);
        const year = date.getFullYear();
        const dateString = `${day}.${month}.${year}`;
        var hours = numberFormat(date.getHours().toString(),2);
        var minutes = numberFormat(date.getMinutes().toString(),2);
        var seconds = numberFormat(date.getSeconds().toString(),2);
        var milliseconds = numberFormat(date.getMilliseconds().toString(),3);
        const timeString = `${hours}:${minutes}:${seconds}.${milliseconds}`;
        const messageString = "message";
        
        var table = document.getElementById("myTable");
        var row = table.insertRow(1);
        var dateCell = row.insertCell(0);
        var timeCell = row.insertCell(1);
        var messageCell = row.insertCell(2);
        dateCell.innerHTML = dateString;
        timeCell.innerHTML = timeString;
        messageCell.innerHTML = messageString;

    }
    function GetDateOnClick(){
        const date = new Date();
        var day = numberFormat(date.getDate().toString(),2);
        var month = numberFormat((date.getMonth()+1).toString(),2);
        var year = date.getFullYear();
        var dateString = `${day}.${month}.${year}`;
        return dateString;
    }
    function GetTimeOnClick(){
        const date = new Date();
        var hours = numberFormat(date.getHours().toString(),2);
        var minutes = numberFormat(date.getMinutes().toString(),2);
        var seconds = numberFormat(date.getSeconds().toString(),2);
        var milliseconds = numberFormat(date.getMilliseconds().toString(),3);
        const timeString = `${hours}:${minutes}:${seconds}.${milliseconds}`;
        return timeString;
    }
    function GetMessageOnClick(){
        const messageString = "message";
        return messageString;
    }
    function numberFormat(number, desiredLength){
      if(number.toString().length == desiredLength){
        return number;
      }
      else{
        number = number.padStart(desiredLength, '0');
        return number;
      }
    }

    </script>
    
    <!----------IMPORTS + CONFIGURATION------------>

    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js";
      
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries
    
      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyDd8whiHqGyOGy8r3jYK6R54WyZj2dDLyc",
        authDomain: "testdata-mkr.firebaseapp.com",
        databaseURL: "https://testdata-mkr-default-rtdb.firebaseio.com",
        projectId: "testdata-mkr",
        storageBucket: "testdata-mkr.appspot.com",
        messagingSenderId: "122625608134",
        appId: "1:122625608134:web:067cd0e1e32760566d4ac7",
        measurementId: "G-RB11SY3ET0"
      };
    
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      
      import{getDatabase, ref, get, set,child, update, remove, onValue}
      from "https://www.gstatic.com/firebasejs/9.19.1/firebase-database.js"
    
      const db = getDatabase();

      //--------------------------References---------------
      var inputbox = document.getElementById("Inputbox");

      var dateString = GetDateOnClick();
      var timeString = GetTimeOnClick();
      var messageString = inputbox.value;//GetMessageOnClick();

      var submitButton = document.getElementById("SubmitButton");
      const date = new Date();
      var path = date.getTime();
      var parentString = ("MessageData/"+path).toString();

      var table = document.getElementById("myTable");

      //-----------INSERT DATA FUNCTION--------------
      function InsertData(){
          set(ref(db, parentString),{
              Date: dateString,
              Time: timeString,
              Message: inputbox.value
          });/*
          .then(()=>{
              alert("data stored successfully");
          })
          .catch((error)=>{
              alert("unsuccessful, error"+error);
          });*/
      }
      //-----------REFRESH PAGE----------------------
      function RefreshPage(){
        window.location.reload();
        /*
        setTimeout(function(){
          window.location.reload();
        }, 1000);
        ShowTable();
        */
      }
      //---------SHOW TABLE--------------------------
      function ShowTable(){
        const dbref = ref(db);
        get(child(dbref, `MessageData/`)).then((snapshot) => {
          if (snapshot.exists()) {
            var data = snapshot.val();
            const numOfData = snapshot.size;
            for (let i = 0; i < numOfData; i++) {
              var row = table.insertRow(1);
              var dateCell = row.insertCell(0);
              var timeCell = row.insertCell(1);
              var messageCell = row.insertCell(2);
              dateCell.innerHTML = data[Object.keys(data)[i]].Date;
              timeCell.innerHTML = data[Object.keys(data)[i]].Time;
              messageCell.innerHTML = data[Object.keys(data)[i]].Message;
            }
          } else {
            console.log("No data available");
          }
        }).catch((error) => {
          console.error(error);
        });
        /*
        var table = document.getElementById("myTable");
        var row = table.insertRow(1);
        var dateCell = row.insertCell(0);
        var timeCell = row.insertCell(1);
        var messageCell = row.insertCell(2);
        dateCell.innerHTML = dateString;
        timeCell.innerHTML = timeString;
        messageCell.innerHTML = messageString;
        */
      }
      //--------RESET TABLE--------------------------
      function ResetTable(){
        const numOfRows = table.rows.length;
        //console.log(numOfRows);
        for (let i = 1; i < numOfRows; i++){
          table.deleteRow(1);

        }
      }
      

      //---------DELETE DATA FUNCTION----------------
      function DeleteData(){
          remove(ref(db, "TheStudents/"+rollbox.value))
          .then(()=>{
              alert("data removed successfully");
          })
          .catch((error)=>{
              alert("unsuccessful, error"+error);
          });
      }

      function DoAll(){
        //setTimeout(function(){
          ResetTable();
          ShowTable();
        //},3000);
        InsertData();
        setTimeout(function(){
          RefreshPage();
        }, 1000);
      }

      //---------Assign Events To Btns---------------
      //submitButton.addEventListener('click', ResetTable);
      //submitButton.addEventListener('click', RefreshPage);
      //submitButton.addEventListener('click', InsertData);
      //submitButton.addEventListener('click', updateTable);
      submitButton.addEventListener('click', DoAll);
      
    </script>
    
  </body>
</html>
